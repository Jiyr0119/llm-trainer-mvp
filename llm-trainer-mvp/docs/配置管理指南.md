# LLM Trainer 配置管理指南

本文档介绍了 LLM Trainer 项目的配置管理系统和环境切换机制，包括后端和前端的配置方式。

## 目录

- [配置概述](#配置概述)
- [后端配置](#后端配置)
  - [配置文件](#后端配置文件)
  - [配置类](#配置类)
  - [环境切换](#后端环境切换)
- [前端配置](#前端配置)
  - [配置文件](#前端配置文件)
  - [环境变量使用](#环境变量使用)
  - [环境切换](#前端环境切换)
- [配置项说明](#配置项说明)

## 配置概述

LLM Trainer 项目采用基于环境变量的配置管理系统，支持开发(dev)、测试(test)和生产(prod)三种环境。配置系统的主要特点：

1. **环境隔离**：不同环境使用独立的配置文件，避免相互干扰
2. **统一管理**：通过配置类集中管理所有配置项
3. **类型安全**：使用 Pydantic 和 TypeScript 提供类型检查
4. **灵活切换**：提供简单的命令行工具在不同环境间切换

## 后端配置

### 后端配置文件

后端使用 `.env` 文件存储配置，不同环境对应不同的配置文件：

- `.env.dev`：开发环境配置
- `.env.test`：测试环境配置
- `.env.prod`：生产环境配置
- `.env`：当前激活的环境配置（由环境切换脚本生成）

### 配置类

后端使用 Pydantic 的 `BaseSettings` 类管理配置，定义在 `app/core/config.py` 文件中：

```python
# 基础配置类
class Settings(BaseSettings):
    # 应用配置
    APP_ENV: Environment = Environment.DEV
    APP_TITLE: str = "LLM Trainer API"
    APP_DESCRIPTION: str = "用于训练和管理LLM模型的API"
    APP_VERSION: str = "0.1.0"
    DEBUG: bool = False
    
    # 服务器配置
    HOST: str = "0.0.0.0"
    PORT: int = 8001
    
    # 数据库配置
    DATABASE_URL: str = "sqlite:///../data/database.db"
    
    # 文件存储配置
    UPLOAD_PATH: str = "../data/uploads"
    MODEL_PATH: str = "../data/models"
    LOG_PATH: str = "../data/logs"
    LOG_LEVEL: str = "INFO"
    
    # CORS配置
    CORS_ORIGINS: List[str] = ["*"]
    
    # 模型配置
    DEFAULT_MODEL: str = "bert-base-uncased"
    
    # 训练配置
    DEFAULT_BATCH_SIZE: int = 8
    DEFAULT_EPOCHS: int = 3
    DEFAULT_LEARNING_RATE: float = 2e-5
    
    class Config:
        env_file = ".env"
        env_file_encoding = "utf-8"
```

### 后端环境切换

使用 `scripts/load_env.py` 脚本切换环境：

```bash
# 切换到开发环境
python scripts/load_env.py dev

# 切换到测试环境
python scripts/load_env.py test

# 切换到生产环境
python scripts/load_env.py prod
```

## 前端配置

### 前端配置文件

前端使用 Vite 的环境变量系统，配置文件包括：

- `.env.development`：开发环境配置
- `.env.test`：测试环境配置
- `.env.production`：生产环境配置
- `.env`：当前激活的环境配置（由环境切换脚本生成）

### 环境变量使用

在前端代码中，可以通过 `import.meta.env` 访问环境变量：

```javascript
// 获取API地址
const apiUrl = import.meta.env.VITE_APP_API_URL

// 获取当前环境
const env = import.meta.env.VITE_APP_ENV

// 获取是否为调试模式
const isDebug = import.meta.env.VITE_APP_DEBUG === 'true'
```

### 前端环境切换

使用 npm 脚本切换环境：

```bash
# 切换到开发环境
npm run env:dev

# 切换到测试环境
npm run env:test

# 切换到生产环境
npm run env:prod
```

## 配置项说明

### 后端配置项

| 配置项 | 说明 | 默认值 |
|-------|------|-------|
| APP_ENV | 应用环境 | dev |
| DEBUG | 调试模式 | true (dev/test), false (prod) |
| HOST | 服务器主机 | 0.0.0.0 |
| PORT | 服务器端口 | 8001 |
| DATABASE_URL | 数据库连接URL | sqlite:///../data/database.db |
| UPLOAD_PATH | 上传文件存储路径 | ../data/uploads |
| MODEL_PATH | 模型存储路径 | ../data/models |
| LOG_PATH | 日志存储路径 | ../data/logs |
| LOG_LEVEL | 日志级别 | DEBUG (dev), INFO (test), WARNING (prod) |
| CORS_ORIGINS | 允许的跨域来源 | * (dev/test), 特定域名 (prod) |
| DEFAULT_MODEL | 默认模型 | bert-base-uncased |
| DEFAULT_BATCH_SIZE | 默认批处理大小 | 8 (dev), 4 (test), 16 (prod) |
| DEFAULT_EPOCHS | 默认训练轮数 | 3 (dev), 1 (test), 5 (prod) |
| DEFAULT_LEARNING_RATE | 默认学习率 | 2e-5 |

### 前端配置项

| 配置项 | 说明 | 默认值 |
|-------|------|-------|
| VITE_APP_ENV | 应用环境 | dev |
| VITE_APP_API_URL | API服务地址 | http://localhost:8001 (dev/test), https://api.llm-trainer.example.com (prod) |
| VITE_APP_TITLE | 应用标题 | LLM Trainer |
| VITE_APP_DEBUG | 调试模式 | true (dev/test), false (prod) |